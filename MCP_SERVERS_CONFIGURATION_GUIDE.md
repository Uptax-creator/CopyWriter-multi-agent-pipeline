# üîß UPTAX - Guia Completo de Configura√ß√£o MCP Servers

> **Documenta√ß√£o completa para configura√ß√£o de todos os MCP servers da plataforma UPTAX**

---

## üéØ **OVERVIEW DO SISTEMA MCP**

### **üìä MCP Servers Configurados**
```
UPTAX MCP ECOSYSTEM
‚îú‚îÄ‚îÄ üóÑÔ∏è Supabase MCP (Database & Vector)
‚îú‚îÄ‚îÄ üîÑ N8N MCP Standard (Automation)
‚îú‚îÄ‚îÄ ü§ñ Senior Developer Agent MCP
‚îú‚îÄ‚îÄ üìö Documentation Agent MCP
‚îú‚îÄ‚îÄ üèóÔ∏è Infrastructure Agent MCP
‚îî‚îÄ‚îÄ üé≠ Agent Orchestrator MCP
```

### **üîê Seguran√ßa e Boas Pr√°ticas**
- **Desenvolvimento Only**: Nunca conectar em produ√ß√£o
- **Read-Only Mode**: Sempre usar modo somente leitura quando poss√≠vel
- **Project Scoped**: Limitar acesso a projetos espec√≠ficos
- **Credential Management**: Usar unified credentials manager
- **Backup Configs**: Manter backups das configura√ß√µes

---

## üóÑÔ∏è **SUPABASE MCP SERVER**

### **üìã Configura√ß√£o B√°sica**

#### **üîë 1. Obter Credenciais**
```bash
# 1. Acesse Supabase Dashboard
# 2. V√° em Settings > API
# 3. Copie o Project Reference ID
# 4. V√° em Account > Access Tokens
# 5. Crie Personal Access Token
```

#### **‚öôÔ∏è 2. Configura√ß√£o Claude Desktop**
```json
{
  "mcpServers": {
    "supabase": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--read-only",
        "--project-ref=YOUR_PROJECT_REF"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "YOUR_PERSONAL_ACCESS_TOKEN"
      }
    }
  }
}
```

#### **üîí 3. Configura√ß√£o Segura (Recomendada)**
```json
{
  "mcpServers": {
    "supabase-dev": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--read-only",
        "--project-ref=${SUPABASE_PROJECT_REF}"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "${SUPABASE_ACCESS_TOKEN}",
        "SUPABASE_PROJECT_REF": "${SUPABASE_PROJECT_REF}"
      }
    }
  }
}
```

### **üõ†Ô∏è Funcionalidades Dispon√≠veis**
- **üìä Database Queries**: Consultas SQL no banco de dados
- **üìã Table Management**: Listar e inspecionar tabelas
- **üîç Data Analysis**: An√°lise de dados e estruturas
- **üìà Metrics & Analytics**: M√©tricas de performance
- **üîê Row Level Security**: Consultar pol√≠ticas RLS

### **üí° Casos de Uso CEO**
```
"Quantos usu√°rios temos ativo no sistema?"
"Qual o crescimento de receita nos √∫ltimos 3 meses?"
"Mostre a performance das integra√ß√µes ERP"
"Analise os dados de uso do dashboard CEO"
```

---

## üîÑ **N8N MCP SERVER**

### **üìã Configura√ß√£o N8N-DEV (Docker)**

#### **‚öôÔ∏è 1. Configura√ß√£o Claude Desktop**
```json
{
  "mcpServers": {
    "n8n-dev": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/n8n_mcp_server_standard.py"
      ],
      "env": {
        "N8N_API_KEY": "${N8N_DEV_API_KEY}",
        "N8N_BASE_URL": "http://localhost:5679",
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev",
        "PYTHONUNBUFFERED": "1"
      },
      "timeout": 30000,
      "restart": true
    }
  }
}
```

#### **üê≥ 2. Configura√ß√£o Docker N8N**
```yaml
# docker-compose.n8n-dev.yml
version: '3.8'
services:
  n8n-dev:
    image: n8nio/n8n:latest
    container_name: n8n-dev
    ports:
      - "5679:5678"
    environment:
      - N8N_BASIC_AUTH_ACTIVE=false
      - N8N_METRICS=true
      - WEBHOOK_URL=http://localhost:5679/
    volumes:
      - n8n_data:/home/node/.n8n
    restart: unless-stopped

volumes:
  n8n_data:
```

#### **üîß 3. Integra√ß√£o com Supabase**
```python
# n8n_supabase_integration.py
class N8NSupabaseIntegration:
    def __init__(self):
        self.n8n_client = N8NClient("http://localhost:5679")
        self.supabase_client = SupabaseClient()
    
    def create_data_sync_workflow(self):
        """Criar workflow para sincronizar dados N8N ‚Üí Supabase"""
        workflow = {
            "name": "CEO Data Sync",
            "nodes": [
                {
                    "name": "Trigger",
                    "type": "n8n-nodes-base.cron",
                    "parameters": {"triggerTimes": {"hour": 8, "minute": 0}}
                },
                {
                    "name": "Get N8N Metrics",
                    "type": "n8n-nodes-base.httpRequest",
                    "parameters": {"url": "http://localhost:5679/rest/executions"}
                },
                {
                    "name": "Store in Supabase",
                    "type": "n8n-nodes-base.supabase",
                    "parameters": {
                        "operation": "insert",
                        "table": "ceo_metrics"
                    }
                }
            ]
        }
        return self.n8n_client.create_workflow(workflow)
```

---

## ü§ñ **AGENTS MCP SERVERS**

### **üë®‚Äçüíª Senior Developer Agent**
```json
{
  "mcpServers": {
    "senior-developer": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/senior_developer_agent_mcp.py"
      ],
      "env": {
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev",
        "AGENT_MODE": "senior_developer",
        "LOG_LEVEL": "INFO"
      },
      "timeout": 60000,
      "restart": true
    }
  }
}
```

**Funcionalidades:**
- Consultas arquiteturais
- Code review automatizado
- Recomenda√ß√µes t√©cnicas
- An√°lise de performance

### **üìö Documentation Agent**
```json
{
  "mcpServers": {
    "documentation": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/documentation_agent_mcp.py"
      ],
      "env": {
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev",
        "DOCS_OUTPUT_PATH": "/Users/kleberdossantosribeiro/uptaxdev/docs",
        "AUTO_GENERATE": "true"
      },
      "timeout": 45000,
      "restart": true
    }
  }
}
```

**Funcionalidades:**
- Gera√ß√£o autom√°tica de documenta√ß√£o
- Atualiza√ß√£o de README files
- API documentation
- Business case updates

### **üèóÔ∏è Infrastructure Agent**
```json
{
  "mcpServers": {
    "infrastructure": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/infrastructure_agent_mcp.py"
      ],
      "env": {
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev",
        "DOCKER_HOST": "unix:///var/run/docker.sock",
        "MONITORING_ENABLED": "true"
      },
      "timeout": 30000,
      "restart": true
    }
  }
}
```

**Funcionalidades:**
- Health checks automatizados
- Docker management
- Performance monitoring
- System recovery

---

## üîß **CONFIGURA√á√ÉO UNIFICADA**

### **üìÑ Claude Desktop Config Completo**
```json
{
  "mcpServers": {
    "supabase-dev": {
      "command": "npx",
      "args": [
        "-y",
        "@supabase/mcp-server-supabase@latest",
        "--read-only",
        "--project-ref=${SUPABASE_PROJECT_REF}"
      ],
      "env": {
        "SUPABASE_ACCESS_TOKEN": "${SUPABASE_ACCESS_TOKEN}"
      }
    },
    "n8n-dev": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/n8n_mcp_server_standard.py"
      ],
      "env": {
        "N8N_API_KEY": "${N8N_DEV_API_KEY}",
        "N8N_BASE_URL": "http://localhost:5679",
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev",
        "PYTHONUNBUFFERED": "1"
      },
      "timeout": 30000,
      "restart": true
    },
    "senior-developer": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/senior_developer_agent_mcp.py"
      ],
      "env": {
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev"
      },
      "timeout": 60000,
      "restart": true
    },
    "infrastructure": {
      "command": "python3",
      "args": [
        "/Users/kleberdossantosribeiro/uptaxdev/infrastructure_agent_mcp.py"
      ],
      "env": {
        "PYTHONPATH": "/Users/kleberdossantosribeiro/uptaxdev"
      },
      "timeout": 30000,
      "restart": true
    }
  }
}
```

---

## üîê **GERENCIAMENTO DE CREDENCIAIS**

### **üìã Unified Credentials Structure**
```json
{
  "version": "3.1_with_supabase",
  "description": "UPTAX Unified Credentials with Supabase MCP",
  "credentials": {
    "supabase": {
      "project_ref": "YOUR_PROJECT_REF_HERE",
      "access_token": "YOUR_PERSONAL_ACCESS_TOKEN",
      "database_url": "postgresql://postgres:[password]@db.[ref].supabase.co:6543/postgres",
      "anon_key": "YOUR_ANON_KEY",
      "service_role_key": "YOUR_SERVICE_ROLE_KEY"
    },
    "n8n": {
      "dev": {
        "url": "http://localhost:5679",
        "api_key": "YOUR_N8N_DEV_API_KEY",
        "webhook_url": "http://localhost:5679/webhook/"
      },
      "prod": {
        "url": "https://uptax-n8n.easypanel.host",
        "api_key": "YOUR_N8N_PROD_API_KEY",
        "webhook_url": "https://uptax-n8n.easypanel.host/webhook/"
      }
    },
    "openai": {
      "api_key": "YOUR_OPENAI_API_KEY",
      "organization": "YOUR_ORG_ID"
    }
  }
}
```

### **üîí Script de Configura√ß√£o Segura**
```python
#!/usr/bin/env python3
"""
Setup seguro das credenciais MCP
"""
import os
import json
from pathlib import Path

def setup_mcp_credentials():
    """Configure MCP credentials securely"""
    
    # Load unified credentials
    with open('credentials.json', 'r') as f:
        creds = json.load(f)
    
    # Set environment variables
    os.environ['SUPABASE_PROJECT_REF'] = creds['supabase']['project_ref']
    os.environ['SUPABASE_ACCESS_TOKEN'] = creds['supabase']['access_token']
    os.environ['N8N_DEV_API_KEY'] = creds['n8n']['dev']['api_key']
    
    # Update Claude Desktop config
    claude_config_path = Path.home() / 'Library/Application Support/Claude/claude_desktop_config.json'
    
    with open(claude_config_path, 'r') as f:
        claude_config = json.load(f)
    
    # Add Supabase MCP server
    claude_config['mcpServers']['supabase-dev'] = {
        "command": "npx",
        "args": [
            "-y",
            "@supabase/mcp-server-supabase@latest",
            "--read-only",
            f"--project-ref={creds['supabase']['project_ref']}"
        ],
        "env": {
            "SUPABASE_ACCESS_TOKEN": creds['supabase']['access_token']
        }
    }
    
    # Save updated config
    with open(claude_config_path, 'w') as f:
        json.dump(claude_config, f, indent=2)
    
    print("‚úÖ MCP credentials configured successfully!")

if __name__ == "__main__":
    setup_mcp_credentials()
```

---

## üß™ **TESTES E VALIDA√á√ÉO**

### **üìä Test Suite MCP Servers**
```python
#!/usr/bin/env python3
"""
Test all MCP server connections
"""
import asyncio
import json
import subprocess

async def test_mcp_servers():
    """Test all configured MCP servers"""
    
    servers = [
        "supabase-dev",
        "n8n-dev", 
        "senior-developer",
        "infrastructure"
    ]
    
    results = {}
    
    for server in servers:
        try:
            # Test server connection
            result = await test_server_connection(server)
            results[server] = {"status": "‚úÖ Active", "response_time": result}
        except Exception as e:
            results[server] = {"status": "‚ùå Error", "error": str(e)}
    
    return results

def generate_test_report(results):
    """Generate MCP test report"""
    report = "# üß™ MCP Servers Test Report\n\n"
    
    for server, result in results.items():
        report += f"## {server}\n"
        report += f"- **Status**: {result['status']}\n"
        if 'response_time' in result:
            report += f"- **Response Time**: {result['response_time']}ms\n"
        if 'error' in result:
            report += f"- **Error**: {result['error']}\n"
        report += "\n"
    
    return report

if __name__ == "__main__":
    results = asyncio.run(test_mcp_servers())
    report = generate_test_report(results)
    print(report)
```

---

## üéØ **CASOS DE USO CEO**

### **üß† Queries Inteligentes com Supabase + N8N**

#### **An√°lise de Performance**
```
CEO: "Como est√° a performance da plataforma hoje?"

Supabase MCP Response:
üìä Database Metrics:
- Active connections: 15/20
- Query response time: avg 45ms
- Table sizes: ceo_tasks (1.2k rows), metrics (5.8k rows)

N8N MCP Response:  
üîÑ Automation Status:
- Active workflows: 8/10
- Success rate: 98.5% (last 24h)
- Failed executions: 2 (non-critical)
```

#### **Business Intelligence**
```
CEO: "Quantas tarefas foram criadas esta semana?"

Supabase Query via MCP:
SELECT COUNT(*) as task_count, 
       AVG(EXTRACT(EPOCH FROM (completed_at - created_at))/3600) as avg_completion_hours
FROM ceo_tasks 
WHERE created_at >= NOW() - INTERVAL '7 days';

Result: 23 tasks created, avg completion time 2.5 hours
```

### **üîÑ Automa√ß√£o Inteligente**
```
CEO: "Crie um workflow para monitorar m√©tricas semanais"

N8N MCP Response:
‚úÖ Workflow created: "CEO Weekly Metrics"
- Trigger: Every Monday 8 AM
- Action 1: Query Supabase for weekly data
- Action 2: Generate executive summary
- Action 3: Send to CEO dashboard
- Status: Active and scheduled
```

---

## üöÄ **DEPLOYMENT E PRODU√á√ÉO**

### **üìã Checklist Pr√©-Deploy**
- [ ] ‚úÖ Supabase MCP configurado e testado
- [ ] ‚úÖ N8N-DEV funcionando com Docker
- [ ] ‚úÖ Agents MCP ativos e responsivos
- [ ] ‚úÖ Credentials unificadas e seguras
- [ ] ‚úÖ Backup de configura√ß√µes realizado
- [ ] ‚úÖ Testes end-to-end executados
- [ ] ‚úÖ Monitoring ativo em todos os servers

### **üîß Comandos de Deploy**
```bash
# 1. Setup credentials
python3 setup_mcp_credentials.py

# 2. Start N8N Docker
docker-compose -f docker-compose.n8n-dev.yml up -d

# 3. Test all connections
python3 test_mcp_servers.py

# 4. Validate CEO workflows
python3 validate_ceo_workflows.py

# 5. Start monitoring
python3 monitoring_dashboard.py
```

---

## üìû **SUPORTE E TROUBLESHOOTING**

### **üö® Problemas Comuns**
1. **Supabase MCP n√£o conecta**
   - Verificar project_ref e access_token
   - Confirmar permiss√µes de leitura
   - Testar conectividade de rede

2. **N8N MCP timeout**
   - Verificar se Docker container est√° rodando
   - Confirmar porta 5679 dispon√≠vel
   - Restart do container N8N

3. **Agents MCP n√£o respondem**
   - Verificar PYTHONPATH configurado
   - Confirmar arquivos Python existem
   - Check logs do Claude Desktop

### **üîß Comandos de Debug**
```bash
# Test Supabase connection
npx @supabase/mcp-server-supabase@latest --project-ref=YOUR_REF

# Test N8N Docker
docker logs n8n-dev

# Test Python agents
python3 -c "import sys; print(sys.path)"

# Claude Desktop logs
tail -f ~/Library/Logs/Claude/claude-desktop.log
```

---

**üîß MCP SERVERS CONFIGURATION GUIDE**  
**Complete Setup for UPTAX AI-First Platform**  
**Ready for CEO Vertical Agent Integration**